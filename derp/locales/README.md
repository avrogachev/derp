# Internationalization (i18n) Setup

This directory contains localization files for the bot, managed using `pybabel` (from the Babel package).

## Translation Workflow

1. **Mark Strings**: In the Python code (`.py` files under `derp/`), mark translatable strings using `_()` or `__()` (for lazy evaluation) imported from `aiogram.utils.i18n`.

    ```python
    from aiogram.utils.i18n import gettext as _

    await message.answer(_("Hello, {name}!").format(name=user_name))
    ```

2. **Extract Strings**: Run the extraction script to scan the code and update the template file (`messages.pot`).

    ```bash
    ./scripts/i18n_extract.sh
    ```

3. **Update Language Files**: Update the language-specific `.po` files based on the new template.

    ```bash
    ./scripts/i18n_update.sh
    ```

    * **New Language?**: If adding a new language (e.g., `fr` for French), initialize its `.po` file first:

        ```bash
        ./scripts/i18n_init.sh fr
        ```

    * **Translate**: Edit the `.po` files (e.g., `en/LC_MESSAGES/messages.po`, `ru/LC_MESSAGES/messages.po`) using a text editor or a specialized tool like Poedit. Fill in the `msgstr "..."` lines corresponding to each `msgid "..."`.

4. **Compile Translations**: Compile the `.po` files into binary `.mo` files, which are used by the bot at runtime.

    ```bash
    ./scripts/i18n_compile.sh
    ```

## File Structure

* `messages.pot`: Template file generated by `pybabel extract`. Contains all extracted strings.
* `<locale>/LC_MESSAGES/messages.po`: Human-readable translation file for a specific language (e.g., `en`, `ru`). **This is the file you edit.**
* `<locale>/LC_MESSAGES/messages.mo`: Compiled binary file used by `gettext` at runtime. Generated by `pybabel compile`.

## Best Practices

* Keep `.po` files in version control so translations are tracked.
* Regularly run the `extract`, `update`, and `compile` steps as you modify the code.
* Use descriptive comments in the code for translators if necessary (e.g., `# Translators: ...`). They can be extracted using `pybabel extract --add-comments=Translators: ...`.
